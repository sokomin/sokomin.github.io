//
//　function keisan()
//  機能：秒間ダメ計算機処理
//
    function keisan()
  {
      hosei = new Array(20);
      kisobougyo = new Array(20);
    // 基礎防御値の取得
      kisobougyo[0] = eval(document.hpbougyocalc.bou00.value);
      kisobougyo[1] = eval(document.hpbougyocalc.bou01.value);
      kisobougyo[2] = eval(document.hpbougyocalc.bou02.value);
      kisobougyo[3] = eval(document.hpbougyocalc.bou03.value);
      kisobougyo[4] = eval(document.hpbougyocalc.bou04.value);
      kisobougyo[5] = eval(document.hpbougyocalc.bou05.value);
      kisobougyo[6] = eval(document.hpbougyocalc.bou06.value);
      kisobougyo[7] = eval(document.hpbougyocalc.bou07.value);
      kisobougyo[8] = eval(document.hpbougyocalc.bou08.value);
      kisobougyo[9] = eval(document.hpbougyocalc.bou09.value);
      
      kisobougyototal = 0 ;
      for (i = 0; i<= 9; i++ ){
        kisobougyototal  += kisobougyo[i];
      }

       tsuikabougyo = new Array(20);
   // 追加防御値の取得
      tsuikabougyo[0] = eval(document.hpbougyocalc.tsuikabou00.value);
      tsuikabougyo[1] = eval(document.hpbougyocalc.tsuikabou01.value);
      tsuikabougyo[2] = eval(document.hpbougyocalc.tsuikabou02.value);
      tsuikabougyo[3] = eval(document.hpbougyocalc.tsuikabou03.value);
      tsuikabougyo[4] = eval(document.hpbougyocalc.tsuikabou04.value);
      tsuikabougyo[5] = eval(document.hpbougyocalc.tsuikabou05.value);
      tsuikabougyo[6] = eval(document.hpbougyocalc.tsuikabou06.value);
      tsuikabougyo[7] = eval(document.hpbougyocalc.tsuikabou07.value);
      tsuikabougyo[8] = eval(document.hpbougyocalc.tsuikabou08.value);
      tsuikabougyo[9] = eval(document.hpbougyocalc.tsuikabou09.value);
      
      tsuikabougyototal_soubi = 0 ;
      for (i = 0; i<= 9; i++ ){
        tsuikabougyototal_soubi  += tsuikabougyo[i];
      }
      
      
       hpkou = new Array(20);
   // HP効率の取得
      hpkou[0] = eval(document.hpbougyocalc.hpkou00.value);
      hpkou[1] = eval(document.hpbougyocalc.hpkou01.value);
      hpkou[2] = eval(document.hpbougyocalc.hpkou02.value);
      hpkou[3] = eval(document.hpbougyocalc.hpkou03.value);
      hpkou[4] = eval(document.hpbougyocalc.hpkou04.value);
      hpkou[5] = eval(document.hpbougyocalc.hpkou05.value);
      hpkou[6] = eval(document.hpbougyocalc.hpkou06.value);
      hpkou[7] = eval(document.hpbougyocalc.hpkou07.value);
      hpkou[8] = eval(document.hpbougyocalc.hpkou08.value);
      hpkou[9] = eval(document.hpbougyocalc.hpkou09.value);
      
      hpkoutotal_soubi = 0 ;
      for (i = 0; i<= 9; i++ ){
        hpkoutotal_soubi  += hpkou[i];
      }

       boukou = new Array(20);
   // 防御効率の取得
      boukou[0] = eval(document.hpbougyocalc.boukou00.value);
      boukou[1] = eval(document.hpbougyocalc.boukou01.value);
      boukou[2] = eval(document.hpbougyocalc.boukou02.value);
      boukou[3] = eval(document.hpbougyocalc.boukou03.value);
      boukou[4] = eval(document.hpbougyocalc.boukou04.value);
      boukou[5] = eval(document.hpbougyocalc.boukou05.value);
      boukou[6] = eval(document.hpbougyocalc.boukou06.value);
      boukou[7] = eval(document.hpbougyocalc.boukou07.value);
      boukou[8] = eval(document.hpbougyocalc.boukou08.value);
      boukou[9] = eval(document.hpbougyocalc.boukou09.value);
      
      boukoutotal_soubi = 0 ;
      for (i = 0; i<= 9; i++ ){
        boukoutotal_soubi  += boukou[i];
      }
      
    // その他の取得
      hontaiLv = eval(document.hpbougyocalc.hontaiLv.value);
      kenkou_moto = eval(document.hpbougyocalc.kenkou.value);
      syokuhosei = eval(document.hpbougyocalc.syokuhosei.value);
      hp_soubi = eval(document.hpbougyocalc.hp_soubi.value);
      hp_skill = eval(document.hpbougyocalc.hp_skill.value);
      seimei = eval(document.hpbougyocalc.seimei.value);
      bure = eval(document.hpbougyocalc.bure.value);
      ebi = eval(document.hpbougyocalc.ebi.value);
      baria = eval(document.hpbougyocalc.baria.value);
      sekizou = eval(document.hpbougyocalc.sekizou.value);
      bodybuilding = eval(document.hpbougyocalc.bodybuilding.value);
      youpe = eval(document.hpbougyocalc.youpe.value);
      pvpbougyo = eval(document.hpbougyocalc.pvpbougyo.value);
      beruseLv = eval(document.hpbougyocalc.beruseLv.value);
      
      if ( document.hpbougyocalc.use_beruse.checked )	use_beruse = 1;
      else												use_beruse = 0;
      if ( document.hpbougyocalc.use_hiyaku.checked )	use_hiyaku = 1;
      else												use_hiyaku = 0;
      if ( document.hpbougyocalc.use_harp.checked )		use_harp = 1;
      else												use_harp = 0;
      
      if ( bure == 0 )	burekouka = 0; 
      else				burekouka = 20 + 2 * ( bure );
	  if ( ebi == 0 )	ebikouka = 0;
	  else				ebikouka = 40 + 4 * ( ebi );
	  if ( baria == 0 ) bariaboukouka = 0;
	  else				bariaboukouka = Math.floor( 2 + 0.4 * baria );
	  bariaboukoukouka = 2 * baria;
	  // ベルセ効果％値の計算
	  if ( beruseLv == 0 )	berusekouka = 0;
	  else					berusekouka = 80 + 2 * beruseLv;
	  
	  // ベルセのON/OFFに対応して、健康の値を計算
	  if ( use_beruse == 1 )	kenkou = Math.floor( kenkou_moto * ( 1 + berusekouka / 100 ));
	  else						kenkou = kenkou_moto;
	  
	  // 秘薬効果の設定
	  if ( use_hiyaku == 1 ){
	  	hp_hiyaku = 85;
	  	boukou_hiyaku = 85;
	  	// ブレと秘薬のうち、効果の大きい方を採用する。
	  	hpkou_skill = Math.max( burekouka, hp_hiyaku);
	  	// エビ、バリア、秘薬のうち最も効果の大きい物を採用する。
	  	boukou_skill = Math.max( ebikouka, bariaboukoukouka, boukou_hiyaku );
	  } else {
		hp_hiyaku = 0;
		boukou_hiyaku = 0;
		hpkou_skill = burekouka;
		boukou_skill = Math.max( ebikouka, bariaboukoukouka );
	  }
	  
	  // ハープ効果の設定
	  if ( use_harp == 1 ){
	  	harp_kouka = 0.2;
	  } else {
	  	harp_kouka = 0;
	  }
	  
  // ＨＰの計算
  //    計算式　INT( HP基本値 * (1 + HP効率 / 100)) + HP追加値
  //　		HP基本値(hpbase)：　本体Lv＋健康＋職補正値
  //　		HP効率(hpkoutotal):　装備＋生命の祝福
  //　		HP追加値(hptsuika): ボディビルティング＋装備＋スキル
  	hpbase = hontaiLv + kenkou + syokuhosei;
  	hpkoutotal = hpkoutotal_soubi + seimei;
  	hptsuika = hp_soubi + hp_skill + bodybuilding;
  	
  	hp_hojonashi = Math.floor((hpbase * ( 1 + ( hpkoutotal+ hp_hiyaku )/100 ) + hptsuika)*(1 + harp_kouka));
//  	hp_hojonashi = Math.floor(hpbase * ( 1 + hpkoutotal/100 )) + hptsuika;
  	hp_hojoari = Math.floor((hpbase * ( 1 + ( hpkoutotal+ hpkou_skill )/100 ) + hptsuika)*(1 + harp_kouka));
  	hp_hojonashi_hiyaku = Math.floor(hpbase * ( 1 + ( hpkoutotal+ hp_hiyaku )/100 )) + hptsuika;
  	hp_hojoari_harp = Math.floor((hpbase * ( 1 + ( hpkoutotal+ burekouka )/100 ) + hptsuika) *(1 + harp_kouka) );
  	hp_hojonashi_hiyaku_harp = Math.floor((hpbase * ( 1 + ( hpkoutotal+ hp_hiyaku )/100 ) + hptsuika)*(1 + harp_kouka));


  // 結果の出力    
    document.hpbougyocalc.res_hp_01.value = hp_hojonashi;
    document.hpbougyocalc.res_hp_02.value = hp_hojoari;
    
  // 防御力の計算
  //    補助なし計算式　INT( 基礎防御力 * ( 1 + 健康/100 ) * (( 1 + 装備、石像の防御効率/100 ) + 装備の追加防御力)
  //    補助あり計算式　INT( 基礎防御力 * ( 1 + 健康/100 ) * (( 1 + (装備、石像の防御効率 + スキルの防御効率)/100 ) + (装備の追加防御力＋スキルの追加防御力))
   
	bougyo_hojonashi =  Math.floor( kisobougyototal * ( 1 + kenkou/100 ) * ( 1 +( boukoutotal_soubi + sekizou + boukou_hiyaku )/100 + tsuikabougyototal_soubi ));
	bougyo_hojoari = Math.floor( kisobougyototal * ( 1 + kenkou/100 ) * ( 1 +( boukoutotal_soubi + sekizou + boukou_skill )/100 ) + ( 1 + kenkou/100 ) * (tsuikabougyototal_soubi + bariaboukouka ));
	bougyo_hojonashi_hiyaku = Math.floor( kisobougyototal * ( 1 + kenkou/100 ) * ( 1 +( boukoutotal_soubi + sekizou + boukou_hiyaku )/100 + tsuikabougyototal_soubi ));
	
	document.hpbougyocalc.res_bougyo_01.value = bougyo_hojonashi;
	document.hpbougyocalc.res_bougyo2_01.value = Math.floor( bougyo_hojonashi*(1+(youpe+pvpbougyo)/100 ));
	document.hpbougyocalc.res_bougyo_02.value = bougyo_hojoari;
	document.hpbougyocalc.res_bougyo2_02.value = Math.floor( bougyo_hojoari*(1+(youpe+pvpbougyo)/100 ));

  }

//
//　Change_syoku( obj )
//　機能：職選択が変更された場合の処理。
//　メンバ：obj
//　戻り値：なし。
//
	function Change_syoku(obj)
  {
    syokuindex = parseInt(document.hpbougyocalc.syoku.value);
    
    update_syokuhosei()  // 職補正値の更新
  }


//
//　Init()
//　機能：ページロード時の初期化処理
//　メンバ：なし
//　戻り値：なし。
//
	function Init()
  {
  }

//
//　soubisyokika()
//　機能：③装備　項目の初期化
//　メンバ：なし
//　戻り値：なし。
//
	function soubisyokika()
  {
    // 基礎防御値
      document.hpbougyocalc.bou00.value = 0;
      document.hpbougyocalc.bou01.value = 0;
      document.hpbougyocalc.bou02.value = 0;
      document.hpbougyocalc.bou03.value = 0;
      document.hpbougyocalc.bou04.value = 0;
      document.hpbougyocalc.bou05.value = 0;
      document.hpbougyocalc.bou06.value = 0;
      document.hpbougyocalc.bou07.value = 0;
      document.hpbougyocalc.bou08.value = 0;
      document.hpbougyocalc.bou09.value = 0;

   // 追加防御値
      document.hpbougyocalc.tsuikabou00.value = 0;
      document.hpbougyocalc.tsuikabou01.value = 0;
      document.hpbougyocalc.tsuikabou02.value = 0;
      document.hpbougyocalc.tsuikabou03.value = 0;
      document.hpbougyocalc.tsuikabou04.value = 0;
      document.hpbougyocalc.tsuikabou05.value = 0;
      document.hpbougyocalc.tsuikabou06.value = 0;
      document.hpbougyocalc.tsuikabou07.value = 0;
      document.hpbougyocalc.tsuikabou08.value = 0;
      document.hpbougyocalc.tsuikabou09.value = 0;
      
   // HP効率
      document.hpbougyocalc.hpkou00.value = 0;
      document.hpbougyocalc.hpkou01.value = 0;
      document.hpbougyocalc.hpkou02.value = 0;
      document.hpbougyocalc.hpkou03.value = 0;
      document.hpbougyocalc.hpkou04.value = 0;
      document.hpbougyocalc.hpkou05.value = 0;
      document.hpbougyocalc.hpkou06.value = 0;
      document.hpbougyocalc.hpkou07.value = 0;
      document.hpbougyocalc.hpkou08.value = 0;
      document.hpbougyocalc.hpkou09.value = 0;

   // 防御効率
      document.hpbougyocalc.boukou00.value = 0;
      document.hpbougyocalc.boukou01.value = 0;
      document.hpbougyocalc.boukou02.value = 0;
      document.hpbougyocalc.boukou03.value = 0;
      document.hpbougyocalc.boukou04.value = 0;
      document.hpbougyocalc.boukou05.value = 0;
      document.hpbougyocalc.boukou06.value = 0;
      document.hpbougyocalc.boukou07.value = 0;
      document.hpbougyocalc.boukou08.value = 0;
      document.hpbougyocalc.boukou09.value = 0;
  }


//
//　update_syokuhosei()
//　機能：職補正値の設定
//　メンバ：なし
//　戻り値：なし。
//
	function update_syokuhosei()
  {
    syokuindex = parseInt(document.hpbougyocalc.syoku.value);
    
    switch( syokuindex ){
      case 1:
      // 剣士、戦士
        document.hpbougyocalc.syokuhosei.value = 30;
        break;
      
      case 4:
      case 7:
      // ＢＩＳ、天使
      // プリ、リトル
        document.hpbougyocalc.syokuhosei.value = 25;
        break;

      case 5:
      case 6:
      case 8:
      // テイマ、サマナ
      // シフ、武道
      // ネクロ、悪魔
        document.hpbougyocalc.syokuhosei.value = 20;
        break;

      case 2:
      case 3:
      case 9:
      case 10:
      case 11:
      // アチャ、ランサ
      // ＷＩＺ、ワンコ
      // 霊術、闘士
      // 光奏師、獣人
      // メイド、黒魔術師
        document.hpbougyocalc.syokuhosei.value = 15;
        break;
    }
  }
